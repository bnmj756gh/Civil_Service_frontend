{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% from "govuk/components/tag/macro.njk" import govukTag %}
{% from "govuk/components/warning-text/macro.njk" import govukWarningText %}

{% extends "template.njk" %}

{% block content %}
  {{ govukBackLink({
    text: "Back to tasks",
    href: "/"
  }) }}

  {% if success %}
    {{ govukNotificationBanner({
      type: "success",
      html: success
    }) }}
  {% endif %}

  {% if error %}
    {{ govukNotificationBanner({
      type: "error",
      html: error
    }) }}
  {% endif %}

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-xl">{{ task.title }}</h1>
      </div>
    </div>

  {% set statusTag %}
    {{ govukTag({ text: task.status, classes: "govuk-tag--blue" }) }}
  {% endset %}

  {{ govukSummaryList({
    rows: [
      {
        key: {
          text: "Status"
        },
        value: {
          html: statusTag
        }
      },
      {
        key: {
          text: "Description"
        },
        value: {
          text: task.description if task.description else "No description provided"
        }
      },
      {
        key: {
          text: "Due Date"
        },
        value: {
          text: task.dueDateTime | date('j M Y, g:i a') if task.dueDateTime else "No due date" 
        }
      }
    ]
  }) }}

    <div id="status-change" class="govuk-!-margin-top-6">
      <h2 class="govuk-heading-m">Change Status</h2>

      <div class="govuk-button-group">
        {% for option in statusOptions %}
          {% if option.value != task.status %}
            <form method="post" action="/tasks/{{ task.id }}/status" style="display: inline;">
              <input type="hidden" name="status" value="{{ option.value }}">
              {{ govukButton({
                text: "Mark as " + option.label,
                classes: "govuk-button--secondary"
              }) }}
            </form>
          {% endif %}
        {% endfor %}
      </div>
    </div>

  <div class="govuk-!-margin-top-8">
      {{ govukWarningText({
        text: "Deleting a task cannot be undone.",
        iconFallbackText: "Warning"
      }) }}

      <form method="post" action="/tasks/{{ task.id }}/delete" onsubmit="return confirm('Are you sure you want to delete this task? This action cannot be undone.');">
        {{ govukButton({
          text: "Delete Task",
          classes: "govuk-button--warning"
        }) }}
      </form>
    </div>

  </div>

{% endblock %}
